services:
  # Backend API service
  - type: web
    name: boxwise-api
    env: node
    buildCommand: cd server && npm install express-fileupload && npm install && cd ../scripts && npm install
    startCommand: cd scripts && node check-and-init-db.js && cd ../server && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 5001
      - key: MONGO_URI
        sync: false # This will be set manually in the Render dashboard
      - key: JWT_SECRET
        sync: false # This will be set manually in the Render dashboard
      - key: JWT_EXPIRE
        value: 30d
      - key: ASSET_ID_AUTO_INCREMENT
        value: "true"
      - key: ASSET_ID_PREFIX
        value: "000-"
      - key: MAX_FILE_SIZE
        value: "5000000"
      - key: UPC_API_URL
        value: https://api.upcitemdb.com/prod/trial/lookup
      - key: CUSTOM_FIELDS_ENABLED
        value: "true"
      - key: CUSTOM_FIELD_TYPES
        value: "text,integer,boolean,timestamp"
      - key: CUSTOM_FIELDS_URL_MARKDOWN
        value: "true"
      - key: CUSTOM_FIELDS_FEATURES
        value: "url_markdown,url_detection,email_detection"
      - key: FILE_UPLOAD_PATH
        value: "./uploads"

  # Frontend static site
  - type: web
    name: boxwise-client
    env: static
    buildCommand: cd client && npm install && npm run build
    staticPublishPath: ./client/build
    routes:
      - type: rewrite
        source: /api/*
        destination: https://boxwise-api-hc0t.onrender.com/*
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: NODE_ENV
        value: production

  # Mobile App Build Service
  - type: web
    name: boxwise-mobile-build
    env: node
    buildCommand: cd mobile && npm install && npm run build
    startCommand: cd mobile && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: API_URL
        value: https://boxwise-api-hc0t.onrender.com
      - key: EXPO_USERNAME
        sync: false # This will be set manually in the Render dashboard
      - key: EXPO_PASSWORD
        sync: false # This will be set manually in the Render dashboard

# Note: To create the owner user, run the following command in the Render.com shell:
# cd scripts && npm install jsonwebtoken && node create-owner-render.js terry@jknelotions.com "cde3CDE#vfr4VFR$" "Terry"

# Mobile App Notes:
# 1. The mobile app requires Expo EAS Build to create the iOS and Android app bundles
# 2. Run the following commands to build the mobile app:
#    - cd mobile && npx eas-cli build --platform ios
#    - cd mobile && npx eas-cli build --platform android
# 3. After building, submit the apps to the App Store and Google Play Store
